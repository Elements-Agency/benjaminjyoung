{{ define "styles" }}
    {{ partial "inside-style.html" . }}
{{ end }}

{{ define "scripts" }}
    {{ partial "inside-scripts.html" . }}

    <script data-cfasync="false" type="text/javascript" src="https://app.ecwid.com/script.js?101772706&data_platform=code&data_date=2024-04-07" charset="utf-8"></script>

    <script type="text/javascript">
        function trackInterest() {
            if (localStorage.clickedInterest) {
                return;
            }

            localStorage.clickedInterest = true;

            fbq('trackCustom', 'Interested');
            gtag('event', 'interested', {});
            window.uetq = window.uetq || [];
            window.uetq.push('event', 'interested', {});

            trackEngaged();
        }

        function trackPotential() {
            if (localStorage.clickedPotential) {
                return;
            }

            localStorage.clickedPotential = true;

            fbq('trackCustom', 'Potential');
            gtag('event', 'potential', {});
            window.uetq = window.uetq || [];
            window.uetq.push('event', 'potential', {});

            trackInterest();
        }

        function focusSignup() {
            if (localStorage.viewSignup) {
                return;
            }

            localStorage.viewSignup = true;
            
            fbq('trackCustom', 'ViewSignup');
            gtag('event', 'view_signup', {});
            
            trackInterest();
        }

        function trackLikely() {
            if (localStorage.clickedLikely) {
                return;
            }

            localStorage.clickedLikely = true;

            fbq('trackCustom', 'Likely');
            gtag('event', 'likely', {});

            trackPotential();
        }

        xProductBrowser("categoriesPerRow=3","views=grid(20,3) list(60) table(60)","categoryView=grid","searchView=list","id=my-store-101772706");

        Ecwid.OnAPILoaded.add(function() {
            Ecwid.OnCartChanged.add(function(cart) {
                if (cart && cart.items && cart.items.length > 0) {
                    fbq('track', 'AddToCart', {
                        content_ids: cart.items.map(function(item) { return item.product.sku ? item.product.sku : item.product.id; }),
                        content_type: 'product',
                        contents: cart.items.map(function(item) { return {id: item.product.sku ? item.product.sku : item.product.id, quantity: item.quantity}; }),
                        value: cart.items.reduce(function(sum, item) { return sum + (item.product.price * item.quantity); }, 0),
                        currency: 'USD'
                    });
                }

                trackLikely();
            });

            Ecwid.OnOrderPlaced.add(function(order) {
                if (order && order.total) {
                    fbq('track', 'Purchase', {
                        content_ids: order.items.map(function(item) { return item.product.sku ? item.product.sku : item.product.id; }),
                        content_type: 'product',
                        contents: order.items.map(function(item) { return {id: item.product.sku ? item.product.sku : item.product.id, quantity: item.quantity}; }),
                        value: order.total,
                        currency: 'USD'
                    });
                }

                trackLikely();
            });

            Ecwid.OnPageSwitch.add(function(page) {
                if (page.type === 'PRODUCT') {
                    trackPotential();
                } else if (page.type === 'CATEGORY') {
                    trackInterest();
                }
            });
        });

        xSearch("id=my-search-101772706");

        localStorage.viewshop = true;

        fbq('trackCustom', 'ViewShop');
        gtag('event', 'view_shop', {});

        fbq('trackCustom', 'ViewProducts');
    </script>
{{ end }}

{{ define "main" }}
    <div id="wrapper">
        <!-- Do NOT remove inline styles on bg below -->
        <div class="bg fixed" style='position:fixed; top:0; left:0; z-index:-1; width:100vw; height:100vh; background-color:#ddd; background-image:url("/images/background.webp"); background-size:cover; background-position:center; background-repeat:no-repeat; background-attachment:scroll;'></div>

    {{ block "header" . }}{{ partial "inside-header.html" .}}{{ end }}

    {{ block "nav" . }}{{ partial "inside-navigation.html" .}}{{ end }}

    <div id="main">
        <section style="text-align:center;">
            <header class="major" style="margin-bottom:0;">
                <h1 style="font-size:3em;">
                    {{ .Title }}
                </h1>
            </header>

            <script>
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('retargetting')) {
                    const countdownDate = new Date();
                    countdownDate.setHours(24, 0, 0, 0); // Set to midnight

                    const countdownFunction = setInterval(function() {
                        const now = new Date().getTime();
                        const distance = countdownDate - now;

                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        document.getElementById("countdown").innerHTML = 
                            "Use coupon code <strong>1SJHXTPG3UTT</strong> for <strong style=\"color:red;\">20% OFF</strong> your order!<br> <em>Expires in: "
                            + hours + "h " + minutes + "m " + seconds + "s </em>";

                        if (distance < 0) {
                            clearInterval(countdownFunction);
                            document.getElementById("countdown").innerHTML = "EXPIRED";
                        }
                    }, 1000);
                }
            </script>
            <div id="countdown" style="font-size: 1.5em; line-height: 1.2em; padding-top:0.5em;"></div>

            <div id="my-store-101772706" class="loader" style="min-height:400px;"></div>

            <br>

            {{ .Content }}

            <div id="my-search-101772706"></div>
            <br>
            
            <strong>Order Resources:</strong>
            <ul style="list-style:none; display:inline-block;">
                <li style="display:inline-block;">
                    <a href="/shipping/" onclick="trackPotential();">Shipping Policy</a>
                </li>
                <li style="display:inline-block;">
                    <a href="/returns/" onclick="trackPotential();">Returns Policy</a>
                </li>
            </ul>
        </section>
    </div>

    {{ block "footer" . }}
        {{ partialCached "inside-footer.html" . }}
    {{ end }}
  </div>

{{ end }}
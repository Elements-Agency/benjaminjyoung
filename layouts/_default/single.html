{{ define "styles" }}
    {{ partial "inside-style.html" . }}

    {{ $bg := .Resources.GetMatch "painting.jpg" }}
    {{ $bg := $bg.Fit "1600x920 webp q50" }}

    <style>
      #wrapper > .bg {
        background-image: url("../../images/overlay.png"),
          linear-gradient(0deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)),
          url("{{ $bg.RelPermalink }}");
      }
    </style>
{{ end }}

{{ define "scripts" }}
    {{ partial "inside-scripts.html" . }}
{{ end }}

{{ define "main" }}
  {{ $section := .Site.GetPage "section" .Section }}
    <div id="wrapper">
    {{ block "header" . }}{{ partial "inside-header.html" .}}{{ end }}

    {{ block "nav" . }}{{ partial "inside-navigation.html" .}}{{ end }}

    <div id="main">
        <section class="post">
            <aside class="instapaper_ignoref b helvetica tracked ttu">
              {{ .CurrentSection.Title }}
            </aside>
            <header class="major">
                {{/* Hugo uses Go's date formatting is set by example. Here are two formats */}}
                {{ if not .Date.IsZero }}
                <time class="date" {{ printf `datetime="%s"` (.Date.Format "2006-01-02T15:04:05Z07:00") | safeHTMLAttr }}>
                  {{- .Date | time.Format (default "January 2, 2006" .Site.Params.date_format) -}}
                </time>
                {{end}}
                <h1>{{- .Title -}}</h1>
                {{ with .Params.author | default .Site.Params.author }}
                <p class="tracked">
                  {{ $.Render "by" }} <strong>
                  {{- if reflect.IsSlice . -}}
                      {{ delimit . ", " | markdownify }}
                  {{- else -}}
                      {{ . | markdownify }}
                  {{- end -}}
                  </strong>
                </p>
                {{ end }}
            </header>

            <section>
              {{ $full := .Resources.GetMatch "painting.jpg" }}
              {{ $full := $full.Fit "920x680 webp q85" }}

              <a href="{{ $full.RelPermalink }}" data-position="center">
              <img src="{{ $full.RelPermalink }}" width="1600" height="800" style="width:90%; height:auto;" alt="{{ .Params.alt }}" title='{{ .Title }} ({{ .Date| time.Format "2006" }}) by {{ .Site.Copyright }}' />
              </a>
            </section>

            <article>
              {{- .Content -}}
              {{- partial "tags.html" . -}}
            </article>

            <section>
              <div class="mt6 instapaper_ignoref">
              {{ if .Site.Config.Services.Disqus.Shortname }}
                {{ template "_internal/disqus.html" . }}
              {{ end }}
              {{ if .Site.Params.commentoEnable }}
                {{- partial "commento.html" . -}}
              {{ end }}
              </div>
            </section>
        </section>

        <aside class="w-30-l mt6-l">
          {{- partial "menu-contextual.html" . -}}
        </aside>
    </div>

    {{ block "footer" . }}{{ partialCached "inside-footer.html" . }}{{ end }}
  </div>
{{ end }}
